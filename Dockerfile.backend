FROM node:18-alpine

WORKDIR /app

COPY ./deployment/package*.json ./
RUN npm install

RUN mkdir -p uploads

ENV PORT=8888
ENV NODE_ENV=production
ENV DB_HOST=postgres
ENV DB_PORT=5432
ENV DB_USER=postgres
ENV DB_PASSWORD=postgres
ENV DB_NAME=alzheimer_diagnosing

EXPOSE 8888

HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD wget -qO- http://localhost:8888/ || exit 1

CMD ["node", "server.js"]