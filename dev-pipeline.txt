PIPELINE DATAHUB: dÃ²ng 5
PIPELINE DIAGNOSING SERVER: dÃ²ng 163
PIPELINE DEPLOY: dÃ²ng 420

TRIá»‚N KHAI PIPELINE JENKINS - ALZHEIMER DATA HUB
==============================================

BIáº¾N MÃ”I TRÆ¯á»œNG CHÃNH:
- BUILD_SCM: https://github.com/CallMeNaul/alzheimers-data-hub.git
- DEPLOY_SCM: https://github.com/CallMeNaul/alztrack-deployment.git
- DOCKER_USER: callmenaul
- DOCKER_IMAGE: alzheimer-app
- DOCKER_IMAGE_BACKEND: alzheimer-backend
- DOCKER_TAG: vX.0 (X lÃ  sá»‘ build)
- SONARQUBE_URL: http://10.0.2.4:9000

1. THÃ”NG TIN CHUNG (Info)
   - Má»¥c Ä‘Ã­ch: Kiá»ƒm tra vÃ  hiá»ƒn thá»‹ thÃ´ng tin mÃ´i trÆ°á»ng triá»ƒn khai
   - CÃ¡c lá»‡nh thá»±c thi:
     + whoami: XÃ¡c Ä‘á»‹nh ngÆ°á»i dÃ¹ng Ä‘ang thá»±c thi pipeline
     + pwd: Hiá»ƒn thá»‹ Ä‘Æ°á»ng dáº«n thÆ° má»¥c hiá»‡n táº¡i
     + ls: Liá»‡t kÃª cÃ¡c file trong thÆ° má»¥c

2. CHECKOUT MÃƒ NGUá»’N (Checkout)
   - Má»¥c Ä‘Ã­ch: Láº¥y mÃ£ nguá»“n má»›i nháº¥t tá»« repository
   - CÃ¡c bÆ°á»›c thá»±c hiá»‡n:
     + cleanWs(): XÃ³a sáº¡ch workspace Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t
     + Checkout tá»« branch 'main' vá»›i credentials 'login-github'
   - Repository: ${BUILD_SCM}
   - Branch: main

3. KIá»‚M TRA THAY Äá»”I (Check Changes)
   - Má»¥c Ä‘Ã­ch: PhÃ¢n tÃ­ch vÃ  phÃ¢n loáº¡i cÃ¡c thay Ä‘á»•i trong code
   - CÆ¡ cháº¿ kiá»ƒm tra:
     + Sá»­ dá»¥ng git diff --name-only HEAD~1 HEAD Ä‘á»ƒ láº¥y danh sÃ¡ch file thay Ä‘á»•i
     + Kiá»ƒm tra Jenkinsfile:
       * Náº¿u chá»‰ cÃ³ Jenkinsfile thay Ä‘á»•i â†’ Pipeline káº¿t thÃºc thÃ nh cÃ´ng
     + PhÃ¢n loáº¡i thay Ä‘á»•i theo pattern:
       * Backend: ^backend/
       * Frontend/App: CÃ¡c file cÃ²n láº¡i (trá»« Jenkinsfile)
   - LÆ°u káº¿t quáº£ vÃ o biáº¿n mÃ´i trÆ°á»ng:
     + env.BACKEND_CHANGES
     + env.APP_CHANGES

4. PHÃ‚N TÃCH SONARQUBE (SonarQube Analysis)
   - Äiá»u kiá»‡n cháº¡y: CÃ³ thay Ä‘á»•i ngoÃ i Jenkinsfile
   - Cáº¥u hÃ¬nh SonarQube:
     + Project Key: alztracker
     + Sources: ToÃ n bá»™ project (.)
     + Server: ${SONARQUBE_URL}
     + Token: ÄÆ°á»£c lÆ°u trong credentials 'sonarqube-token'
   - Quy trÃ¬nh:
     1. Cháº¡y sonar-scanner vá»›i cÃ¡c tham sá»‘ cáº¥u hÃ¬nh
     2. Äá»£i vÃ  kiá»ƒm tra Quality Gate
     3. Pipeline tiáº¿p tá»¥c ngay cáº£ khi Quality Gate tháº¥t báº¡i

5. QUÃ‰T DEPENDENCIES (Scan Dependencies)
   - Äiá»u kiá»‡n cháº¡y: CÃ³ thay Ä‘á»•i ngoÃ i Jenkinsfile
   - CÃ¡c bÆ°á»›c quÃ©t:
     1. CÃ i Ä‘áº·t dependencies:
        + npm install
     2. Kiá»ƒm tra báº£o máº­t:
        + npm audit (bÃ¡o cÃ¡o lá»— há»•ng báº£o máº­t)
        + npm run lint (kiá»ƒm tra code style)
     3. OWASP Dependency Check:
        + Tham sá»‘: -s . -f HTML --prettyPrint --failOnCVSS 7 --enableRetired
        + Táº¡o bÃ¡o cÃ¡o HTML: dependency-check-report.html
     4. Kiá»ƒm tra package lá»—i thá»i:
        + npm outdated
     5. ÄÃ¡nh giÃ¡ má»©c Ä‘á»™ nghiÃªm trá»ng cá»§a lá»— há»•ng

6. QUÃ‰T FILESYSTEM Báº°NG TRIVY (Trivy Filesystem Scan)
   - Äiá»u kiá»‡n cháº¡y: CÃ³ thay Ä‘á»•i ngoÃ i Jenkinsfile
   - Cáº¥u hÃ¬nh Trivy:
     + Cache directory: /root/.cache/
     + Severity: HIGH,CRITICAL
     + Exit code: 1 náº¿u phÃ¡t hiá»‡n lá»— há»•ng
   - Output: LÆ°u káº¿t quáº£ vÃ o file vulnerabilities.txt

7. BUILD VÃ€ PUSH DOCKER IMAGES
   - XÃ¡c thá»±c Docker Hub:
     + Sá»­ dá»¥ng credentials 'login-dockerhub'
   - Quy trÃ¬nh Backend (náº¿u cÃ³ thay Ä‘á»•i):
     1. Build: docker build -t ${DOCKER_USER}/${DOCKER_IMAGE_BACKEND}:${DOCKER_TAG} -f backend/Dockerfile .
     2. Push: docker push ${DOCKER_USER}/${DOCKER_IMAGE_BACKEND}:${DOCKER_TAG}
   - Quy trÃ¬nh Frontend/App (náº¿u cÃ³ thay Ä‘á»•i):
     1. Build: docker build -t ${APP_TAG} .
     2. Push: docker push ${APP_TAG}

8. QUÃ‰T DOCKER IMAGES Báº°NG TRIVY (Trivy Image Scan)
   - XÃ¡c thá»±c GitHub Container Registry:
     + Sá»­ dá»¥ng credentials 'login-ghcr'
   - Cáº¥u hÃ¬nh quÃ©t:
     + Cache directory: /root/.cache/
     + Severity: HIGH,CRITICAL
     + Timeout: 45 phÃºt
     + Ignore unfixed vulnerabilities
   - QuÃ©t riÃªng cho tá»«ng image (backend/app) náº¿u cÃ³ thay Ä‘á»•i
   - Output: LÆ°u káº¿t quáº£ vÃ o file app_vulnerabilities.txt vÃ  backend_vulnerabilities.txt

9. CHUáº¨N Bá»Š TRIá»‚N KHAI (Cleanup & Checkout Deploy)
   - XÃ³a workspace hiá»‡n táº¡i: cleanWs()
   - Clone repository triá»ƒn khai:
     + Repository: ${DEPLOY_SCM}
     + Branch: main
     + Credentials: 'login-github'

10. Cáº¤U HÃŒNH GIT (Setup Git Configuration)
    - Kiá»ƒm tra branch hiá»‡n táº¡i: git rev-parse --abbrev-ref HEAD
    - Chuyá»ƒn sang branch main náº¿u cáº§n: git checkout main
    - Äáº£m báº£o lÃ m viá»‡c trÃªn branch chÃ­nh xÃ¡c trÆ°á»›c khi deploy

11. TRIá»‚N KHAI LÃŠN PRODUCTION (Deploy to Production)
    - Cáº­p nháº­t file docker-compose.yml:
      + Thay Ä‘á»•i tag cá»§a image backend (náº¿u cÃ³)
      + Thay Ä‘á»•i tag cá»§a image app (náº¿u cÃ³)
    - Quy trÃ¬nh git:
      1. git add docker-compose.yml
      2. git status (kiá»ƒm tra thay Ä‘á»•i)
      3. git commit -m "Update deployment file to use version ${DOCKER_TAG}"
      4. git push origin main

12. HOÃ€N Táº¤T (Post Actions)
    - Cleanup Ä‘Äƒng nháº­p:
      + docker logout
      + docker logout ghcr.io
    - Dá»n dáº¹p images:
      + XÃ³a cÃ¡c image backend cÅ© (khÃ¡c tag hiá»‡n táº¡i)
      + XÃ³a cÃ¡c image app cÅ© (khÃ¡c tag hiá»‡n táº¡i)
    - ThÃ´ng bÃ¡o káº¿t quáº£:
      + Success: "âœ… Pipeline completed successfully!"
      + Failure: "âŒ Pipeline failed!"

TÃNH NÄ‚NG Báº¢O Máº¬T VÃ€ KIá»‚M SOÃT:
1. Quáº£n lÃ½ Credentials:
   - login-github: Truy cáº­p GitHub repositories
   - login-dockerhub: Push images lÃªn Docker Hub
   - login-ghcr: Truy cáº­p GitHub Container Registry
   - sonarqube-token: XÃ¡c thá»±c vá»›i SonarQube
   - login-sonarqube: Kiá»ƒm tra Quality Gate

2. Kiá»ƒm SoÃ¡t PhiÃªn Báº£n:
   - Sá»­ dá»¥ng tag version theo sá»‘ build
   - LÆ°u trá»¯ song song cáº£ backend vÃ  frontend
   - Backup tá»± Ä‘á»™ng cÃ¡c version cÅ©

3. Quy TrÃ¬nh Báº£o Máº­t:
   - SonarQube: PhÃ¢n tÃ­ch cháº¥t lÆ°á»£ng code
   - OWASP: Kiá»ƒm tra dependencies
   - Trivy: QuÃ©t filesystem vÃ  container
   - npm audit: Kiá»ƒm tra package vulnerabilities

4. Xá»­ LÃ½ Lá»—i:
   - Ghi log chi tiáº¿t má»—i bÆ°á»›c
   - ThÃ´ng bÃ¡o lá»—i cá»¥ thá»ƒ
   - CÆ¡ cháº¿ rollback khi cáº§n

5. Tá»‘i Æ¯u Hiá»‡u Suáº¥t:
   - Cleanup tá»± Ä‘á»™ng
   - XÃ³a cÃ¡c image khÃ´ng cáº§n thiáº¿t
   - Tá»‘i Æ°u cache trong quÃ¡ trÃ¬nh build 

TRIá»‚N KHAI PIPELINE JENKINS - ALZHEIMER DIAGNOSING SERVER

THÃ”NG TIN MÃ”I TRÆ¯á»œNG (ENVIRONMENT VARIABLES):
- BUILD_SCM: https://github.com/CallMeNaul/alztracker-diagnosing_server.git
  + Repository chá»©a mÃ£ nguá»“n chÃ­nh cá»§a á»©ng dá»¥ng
  + ÄÆ°á»£c sá»­ dá»¥ng trong giai Ä‘oáº¡n Checkout Ä‘á»ƒ láº¥y mÃ£ nguá»“n

- DEPLOY_SCM: https://github.com/CallMeNaul/alztrack-deployment.git
  + Repository chá»©a cáº¥u hÃ¬nh deployment
  + ÄÆ°á»£c sá»­ dá»¥ng trong giai Ä‘oáº¡n Deploy Ä‘á»ƒ cáº­p nháº­t cáº¥u hÃ¬nh

- DOCKER_USER: callmenaul
  + TÃªn ngÆ°á»i dÃ¹ng Docker Hub
  + DÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng tÃªn image vÃ  push lÃªn registry

- DOCKER_IMAGE: alzheimer-diagnosing-server
  + TÃªn image Docker cá»§a á»©ng dá»¥ng
  + Káº¿t há»£p vá»›i DOCKER_USER táº¡o thÃ nh tÃªn Ä‘áº§y Ä‘á»§: callmenaul/alzheimer-diagnosing-server

- DOCKER_TAG: vX.0 (X lÃ  sá»‘ build)
  + Version cá»§a image, tá»± Ä‘á»™ng tÄƒng theo sá»‘ build
  + VÃ­ dá»¥: v1.0, v2.0, v3.0,...

- DEPLOYMENT_FILE: docker-compose.yml
  + File cáº¥u hÃ¬nh Docker Compose cho deployment
  + Chá»©a thÃ´ng tin vá» services, networks, volumes,...

- SCAN_OUTPUT: vulnerabilities.txt
  + File lÆ°u káº¿t quáº£ quÃ©t báº£o máº­t
  + ÄÆ°á»£c sá»­ dá»¥ng bá»Ÿi Trivy trong cÃ¡c bÆ°á»›c scan

- DEPLOY_BRANCH: main
  + Branch chÃ­nh cho deployment
  + Má»i thay Ä‘á»•i deployment Ä‘á»u Ä‘Æ°á»£c push lÃªn branch nÃ y

CÃC GIAI ÄOáº N THá»°C HIá»†N (STAGES):

1. Info (ThÃ´ng tin há»‡ thá»‘ng)
   Má»¥c Ä‘Ã­ch: Kiá»ƒm tra vÃ  xÃ¡c nháº­n mÃ´i trÆ°á»ng thá»±c thi pipeline
   CÃ¡c lá»‡nh thá»±c hiá»‡n:
   - whoami: Hiá»ƒn thá»‹ user Ä‘ang thá»±c thi pipeline
   - pwd: Hiá»ƒn thá»‹ Ä‘Æ°á»ng dáº«n thÆ° má»¥c hiá»‡n táº¡i
   - ls: Liá»‡t kÃª cÃ¡c file trong thÆ° má»¥c
   Ã nghÄ©a: GiÃºp debug khi cÃ³ váº¥n Ä‘á» vá» permissions hoáº·c Ä‘Æ°á»ng dáº«n

2. Checkout (Láº¥y mÃ£ nguá»“n)
   Má»¥c Ä‘Ã­ch: Chuáº©n bá»‹ mÃ£ nguá»“n má»›i nháº¥t cho quÃ¡ trÃ¬nh build
   CÃ¡c bÆ°á»›c:
   - cleanWs(): XÃ³a sáº¡ch workspace Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t
   - Sá»­ dá»¥ng GitSCM Ä‘á»ƒ clone repository:
     + URL: BUILD_SCM
     + Branch: main
     + Credentials: login-github (SSH key hoáº·c username/password)
   Káº¿t quáº£: CÃ³ mÃ£ nguá»“n má»›i nháº¥t trong workspace

3. Check Changes (Kiá»ƒm tra thay Ä‘á»•i)
   Má»¥c Ä‘Ã­ch: Tá»‘i Æ°u hÃ³a pipeline báº±ng cÃ¡ch kiá»ƒm tra pháº¡m vi thay Ä‘á»•i
   CÃ¡ch thá»±c hiá»‡n:
   - Sá»­ dá»¥ng git diff Ä‘á»ƒ so sÃ¡nh vá»›i commit trÆ°á»›c
   - PhÃ¢n tÃ­ch danh sÃ¡ch file thay Ä‘á»•i
   Xá»­ lÃ½ Ä‘áº·c biá»‡t:
   - Náº¿u chá»‰ cÃ³ Jenkinsfile thay Ä‘á»•i:
     + Set currentBuild.result = 'SUCCESS'
     + Set env.ONLY_JENKINSFILE_CHANGED = 'true'
     + Bá» qua cÃ¡c stage cÃ²n láº¡i
   LÃ½ do: TrÃ¡nh cháº¡y khÃ´ng cáº§n thiáº¿t cÃ¡c bÆ°á»›c build vÃ  deploy

4. Lint Backend (Kiá»ƒm tra cháº¥t lÆ°á»£ng code)
   Má»¥c Ä‘Ã­ch: Äáº£m báº£o cháº¥t lÆ°á»£ng vÃ  tiÃªu chuáº©n code Python
   CÃ´ng cá»¥: pylint
   CÃ¡c bÆ°á»›c:
   - CÃ i Ä‘áº·t pylint thÃ´ng qua pip
   - Cháº¡y pylint trÃªn file backend.py
   Xá»­ lÃ½ lá»—i:
   - Sá»­ dá»¥ng || true Ä‘á»ƒ khÃ´ng dá»«ng pipeline khi cÃ³ warning
   - Log káº¿t quáº£ Ä‘á»ƒ review sau
   Äiá»u kiá»‡n: Chá»‰ cháº¡y khi cÃ³ thay Ä‘á»•i ngoÃ i Jenkinsfile

5. Update Model (Cáº­p nháº­t model AI)
   Má»¥c Ä‘Ã­ch: Cáº­p nháº­t model machine learning má»›i nháº¥t
   CÃ´ng cá»¥: rclone
   CÃ¡c bÆ°á»›c:
   - Äá»c Ä‘Æ°á»ng dáº«n model tá»« file model.txt (dÃ²ng Ä‘áº§u tiÃªn)
   - Sá»­ dá»¥ng rclone Ä‘á»ƒ copy tá»« Google Drive
   Cáº¥u hÃ¬nh:
   - YÃªu cáº§u cáº¥u hÃ¬nh rclone vá»›i Google Drive
   - ÄÆ°á»ng dáº«n model Ä‘Æ°á»£c lÆ°u trong model.txt
   Káº¿t quáº£: Model má»›i Ä‘Æ°á»£c táº£i vá» workspace

6. Trivy Filesystem Scan (QuÃ©t báº£o máº­t há»‡ thá»‘ng file)
   Má»¥c Ä‘Ã­ch: PhÃ¡t hiá»‡n cÃ¡c lá»— há»•ng báº£o máº­t trong mÃ£ nguá»“n
   CÃ´ng cá»¥: Trivy
   Cáº¥u hÃ¬nh scan:
   - Severity: HIGH, CRITICAL (chá»‰ quÃ©t lá»— há»•ng nghiÃªm trá»ng)
   - Cache directory: /root/.cache/
   - No progress: Táº¯t hiá»ƒn thá»‹ thanh tiáº¿n trÃ¬nh
   Káº¿t quáº£:
   - LÆ°u vÃ o file vulnerabilities.txt
   - Hiá»ƒn thá»‹ káº¿t quáº£ quÃ©t
   Xá»­ lÃ½: Tiáº¿p tá»¥c pipeline ngay cáº£ khi phÃ¡t hiá»‡n lá»— há»•ng

7. Validate Dockerfile (Kiá»ƒm tra Dockerfile)
   Má»¥c Ä‘Ã­ch: Äáº£m báº£o Dockerfile tuÃ¢n thá»§ best practices
   CÃ´ng cá»¥: hadolint
   CÃ¡c bÆ°á»›c kiá»ƒm tra:
   - CÃº phÃ¡p vÃ  cáº¥u trÃºc Dockerfile
   - XÃ¡c Ä‘á»‹nh vÃ  log base image
   Xá»­ lÃ½ káº¿t quáº£:
   - Log warnings vÃ  errors
   - Tiáº¿p tá»¥c ngay cáº£ khi cÃ³ lá»—i (|| true)
   ThÃ´ng tin thu tháº­p:
   - Base image Ä‘Æ°á»£c sá»­ dá»¥ng
   - CÃ¡c vi pháº¡m best practices

8. Build and Push Docker Image (Táº¡o vÃ  Ä‘áº©y image)
   Má»¥c Ä‘Ã­ch: Táº¡o container image vÃ  publish lÃªn registry
   XÃ¡c thá»±c:
   - Sá»­ dá»¥ng credentials 'login-dockerhub'
   - Login vÃ o Docker Hub qua CLI
   CÃ¡c bÆ°á»›c build:
   - Build image vá»›i tag má»›i
   - Tag format: ${DOCKER_USER}/${DOCKER_IMAGE}:${DOCKER_TAG}
   Push image:
   - Push lÃªn Docker Hub
   - Verify push thÃ nh cÃ´ng
   Log thÃ´ng tin:
   - Image name vÃ  tag
   - Káº¿t quáº£ push

9. Trivy Image Scan (QuÃ©t báº£o máº­t Docker image)
   Má»¥c Ä‘Ã­ch: Kiá»ƒm tra báº£o máº­t cá»§a container image
   Cáº¥u hÃ¬nh scan:
   - Severity: HIGH, CRITICAL
   - Timeout: 2700 giÃ¢y (45 phÃºt)
   - Ignore unfixed: Bá» qua lá»— há»•ng chÆ°a cÃ³ báº£n vÃ¡
   XÃ¡c thá»±c:
   - Login vÃ o GitHub Container Registry
   - Sá»­ dá»¥ng credentials 'login-ghcr'
   Káº¿t quáº£:
   - LÆ°u vÃ o file vulnerabilities.txt
   - Hiá»ƒn thá»‹ bÃ¡o cÃ¡o chi tiáº¿t

10. Cleanup Before Deploy (Dá»n dáº¹p trÆ°á»›c khi deploy)
    Má»¥c Ä‘Ã­ch: Chuáº©n bá»‹ mÃ´i trÆ°á»ng sáº¡ch cho deployment
    HÃ nh Ä‘á»™ng:
    - XÃ³a toÃ n bá»™ workspace hiá»‡n táº¡i
    - Äáº£m báº£o khÃ´ng cÃ³ file thá»«a
    LÃ½ do:
    - TrÃ¡nh xung Ä‘á»™t file
    - Äáº£m báº£o deployment sáº¡ch sáº½

11. Checkout Deploy (Láº¥y mÃ£ nguá»“n deployment)
    Má»¥c Ä‘Ã­ch: Chuáº©n bá»‹ cáº¥u hÃ¬nh deployment má»›i nháº¥t
    Repository:
    - URL: DEPLOY_SCM
    - Branch: main
    XÃ¡c thá»±c:
    - Sá»­ dá»¥ng credentials 'login-github'
    - Äáº£m báº£o quyá»n push
    Káº¿t quáº£:
    - CÃ³ Ä‘Æ°á»£c cáº¥u hÃ¬nh deployment má»›i nháº¥t

12. Setup Git Configuration (Cáº¥u hÃ¬nh Git)
    Má»¥c Ä‘Ã­ch: Chuáº©n bá»‹ mÃ´i trÆ°á»ng Git cho deployment
    Kiá»ƒm tra:
    - XÃ¡c Ä‘á»‹nh branch hiá»‡n táº¡i
    - So sÃ¡nh vá»›i DEPLOY_BRANCH
    Xá»­ lÃ½:
    - Tá»± Ä‘á»™ng chuyá»ƒn vá» branch main náº¿u cáº§n
    - Äáº£m báº£o Ä‘Ãºng branch cho deployment

13. Deploy to Production (Triá»ƒn khai)
    Má»¥c Ä‘Ã­ch: Cáº­p nháº­t vÃ  triá»ƒn khai phiÃªn báº£n má»›i
    Cáº­p nháº­t cáº¥u hÃ¬nh:
    - Thay Ä‘á»•i tag trong docker-compose.yml
    - Sá»­ dá»¥ng sed Ä‘á»ƒ cáº­p nháº­t version
    Kiá»ƒm tra:
    - Hiá»ƒn thá»‹ file sau khi cáº­p nháº­t
    - Verify thay Ä‘á»•i
    Git operations:
    - Add file thay Ä‘á»•i
    - Commit vá»›i message cá»¥ thá»ƒ
    - Push lÃªn DEPLOY_BRANCH
    HoÃ n táº¥t:
    - Clone láº¡i repository chÃ­nh
    - Chuáº©n bá»‹ cho láº§n build tiáº¿p theo

GIAI ÄOáº N Káº¾T THÃšC (POST STAGES):

1. Always (LuÃ´n thá»±c hiá»‡n)
   Má»¥c Ä‘Ã­ch: Dá»n dáº¹p vÃ  giáº£i phÃ³ng tÃ i nguyÃªn
   ÄÄƒng xuáº¥t:
   - Docker Hub logout
   - GitHub Container Registry logout
   Dá»n dáº¹p Docker:
   - XÃ³a cÃ¡c image cÅ© cá»§a project
   - XÃ³a cÃ¡c dangling images
   - Giáº£i phÃ³ng disk space
   Äiá»u kiá»‡n:
   - Chá»‰ thá»±c hiá»‡n khi cÃ³ thay Ä‘á»•i ngoÃ i Jenkinsfile
   Xá»­ lÃ½ lá»—i:
   - Log warning náº¿u khÃ´ng xÃ³a Ä‘Æ°á»£c image
   - Tiáº¿p tá»¥c process ngay cáº£ khi cÃ³ lá»—i

2. Success (ThÃ nh cÃ´ng)
   HÃ nh Ä‘á»™ng:
   - Hiá»ƒn thá»‹ thÃ´ng bÃ¡o thÃ nh cÃ´ng
   - Log káº¿t quáº£ build
   Ã nghÄ©a:
   - Pipeline hoÃ n thÃ nh táº¥t cáº£ stages
   - KhÃ´ng cÃ³ lá»—i nghiÃªm trá»ng

3. Failure (Tháº¥t báº¡i)
   HÃ nh Ä‘á»™ng:
   - Hiá»ƒn thá»‹ thÃ´ng bÃ¡o tháº¥t báº¡i
   - Log lá»—i chi tiáº¿t
   Ã nghÄ©a:
   - CÃ³ lá»—i trong quÃ¡ trÃ¬nh thá»±c hiá»‡n
   - Cáº§n review logs Ä‘á»ƒ xÃ¡c Ä‘á»‹nh nguyÃªn nhÃ¢n

LÆ¯U Ã QUAN TRá»ŒNG (IMPORTANT NOTES):

1. Agent Configuration
   - Sá»­ dá»¥ng agent vá»›i label 'local-agent'
   - Äáº£m báº£o agent cÃ³ Ä‘á»§ quyá»n vÃ  cÃ´ng cá»¥ cáº§n thiáº¿t

2. Error Handling
   - Nhiá»u bÆ°á»›c sá»­ dá»¥ng || true
   - TrÃ¡nh pipeline fail khi cÃ³ lá»—i khÃ´ng nghiÃªm trá»ng
   - Log Ä‘áº§y Ä‘á»§ Ä‘á»ƒ debug

3. Security Credentials
   - login-github: Truy cáº­p GitHub repositories
   - login-dockerhub: Push/pull Docker images
   - login-ghcr: Truy cáº­p GitHub Container Registry
   - Äáº£m báº£o báº£o máº­t thÃ´ng tin nháº¡y cáº£m

4. Optimization
   - Kiá»ƒm tra thay Ä‘á»•i Ä‘á»ƒ skip stages khÃ´ng cáº§n thiáº¿t
   - Sá»­ dá»¥ng cache cho Docker builds vÃ  scans
   - Tá»‘i Æ°u thá»i gian thá»±c hiá»‡n

5. Security Integration
   - Trivy: QuÃ©t lá»— há»•ng báº£o máº­t
   - hadolint: Kiá»ƒm tra Dockerfile
   - Táº­p trung vÃ o cÃ¡c lá»— há»•ng nghiÃªm trá»ng

6. Automated Versioning
   - Tá»± Ä‘á»™ng tÄƒng version theo build number
   - Cáº­p nháº­t version trong mÃ´i trÆ°á»ng production
   - Tracking history qua git commits

7. Pipeline Flexibility
   - CÃ³ thá»ƒ skip stages khi cáº§n
   - Xá»­ lÃ½ nhiá»u loáº¡i thay Ä‘á»•i khÃ¡c nhau
   - Dá»… dÃ ng má»Ÿ rá»™ng vÃ  maintain 

=== PIPELINE TRIá»‚N KHAI á»¨NG Dá»¤NG ALZTRACK ===

1. KHá»I Táº O PIPELINE
   - Sá»­ dá»¥ng agent: any (cÃ³ thá»ƒ cháº¡y trÃªn báº¥t ká»³ node Jenkins nÃ o)
   - Thiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng:
     + DEPLOY_SCM: Repository chá»©a mÃ£ nguá»“n (https://github.com/CallMeNaul/alztrack-deployment.git)

2. GIAI ÄOáº N: INFO (â„¹ï¸)
   - Má»¥c Ä‘Ã­ch: Hiá»ƒn thá»‹ thÃ´ng tin há»‡ thá»‘ng trÆ°á»›c khi báº¯t Ä‘áº§u
   - CÃ¡c bÆ°á»›c thá»±c hiá»‡n:
     + Hiá»ƒn thá»‹ user Ä‘ang thá»±c thi (whoami)
     + Hiá»ƒn thá»‹ thÆ° má»¥c hiá»‡n táº¡i (pwd)
     + Liá»‡t kÃª cÃ¡c file trong thÆ° má»¥c (ls)

3. GIAI ÄOáº N: CHECKOUT (ğŸ“¥)
   - Má»¥c Ä‘Ã­ch: Láº¥y mÃ£ nguá»“n tá»« repository
   - CÃ¡c bÆ°á»›c thá»±c hiá»‡n:
     + Dá»n dáº¹p workspace cÅ© (cleanWs)
     + Clone repository tá»« GitHub:
       * Branch: main
       * Sá»­ dá»¥ng credentials: login-github
       * URL: ${DEPLOY_SCM}

4. GIAI ÄOáº N: DEPLOY APPLICATION (ğŸš€)
   - Má»¥c Ä‘Ã­ch: Triá»ƒn khai á»©ng dá»¥ng sá»­ dá»¥ng Docker Compose
   - CÃ¡c bÆ°á»›c thá»±c hiá»‡n:
     + Dá»«ng vÃ  xÃ³a cÃ¡c container cÅ© (docker-compose down -v)
     + Khá»Ÿi Ä‘á»™ng cÃ¡c container má»›i (docker-compose up -d)
     + CÃ¡c service Ä‘Æ°á»£c triá»ƒn khai:
       * PostgreSQL Database
       * Backend Service
       * Frontend Application
       * Diagnosing Server

5. GIAI ÄOáº N: HEALTH CHECK (ğŸ¥)
   - Má»¥c Ä‘Ã­ch: Kiá»ƒm tra tÃ¬nh tráº¡ng hoáº¡t Ä‘á»™ng cá»§a cÃ¡c service
   - CÃ¡c bÆ°á»›c thá»±c hiá»‡n:
     + Chá» 30 giÃ¢y cho cÃ¡c service khá»Ÿi Ä‘á»™ng (â³)
     + Kiá»ƒm tra tráº¡ng thÃ¡i cÃ¡c container (ğŸ”):
       * alzheimer-postgres
       * alzheimer-backend
       * alzheimer-app
       * alzheimer-diagnosing-server
     + Kiá»ƒm tra health check cá»§a diagnosing server:
       * Gá»i API: http://localhost:8000/health

6. Xá»¬ LÃ Káº¾T QUáº¢
   A. ThÃ nh cÃ´ng (âœ…):
      - Hiá»ƒn thá»‹ thÃ´ng bÃ¡o "Pipeline completed successfully!"
      
   B. Tháº¥t báº¡i (âŒ):
      - Rollback: Dá»«ng vÃ  xÃ³a táº¥t cáº£ cÃ¡c container
      - Hiá»ƒn thá»‹ thÃ´ng bÃ¡o "Pipeline failed!"

LÆ¯U Ã QUAN TRá»ŒNG:
- Pipeline sá»­ dá»¥ng Docker Compose Ä‘á»ƒ quáº£n lÃ½ cÃ¡c container
- Cáº§n thiáº¿t láº­p credentials 'login-github' trong Jenkins
- Táº¥t cáº£ cÃ¡c service pháº£i hoáº¡t Ä‘á»™ng thÃ nh cÃ´ng Ä‘á»ƒ pipeline Ä‘Æ°á»£c coi lÃ  thÃ nh cÃ´ng
- Trong trÆ°á»ng há»£p lá»—i, há»‡ thá»‘ng sáº½ tá»± Ä‘á»™ng rollback Ä‘á»ƒ trÃ¡nh tráº¡ng thÃ¡i khÃ´ng nháº¥t quÃ¡n 